<!-- templates/properties/property_form.html -->
{% extends 'base.html' %}
{% block content %}
<div class="container" style="max-width: 650px; margin: auto; padding: 20px;">
    <h2>{{ title }}</h2>

    <form method="post" enctype="multipart/form-data" style="display: flex; flex-direction: column; gap: 15px;">
        {% csrf_token %}
        {{ form.as_p }}

        <!-- File upload input -->
        <div>
            <label for="images">Property Images:</label>
            <input type="file" id="images" name="images" multiple>
        </div>

        {% if editing and images %}
            <hr>
            <h3>Existing Images</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                {% for img in images %}
                    <div style="position: relative; width: 140px;">
                        <img src="{{ img.image.url }}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 6px;">
                        <button type="button" onclick="deleteImage({{ img.id }})">âœ•</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <button type="submit">{{ button_text }}</button>
        <a href="{{ cancel_url }}">Cancel</a>
    </form>
</div>

<script>
function deleteImage(imageId) {
    fetch(`/landlords/delete-image/${imageId}/`, {
        method: "POST",
        headers: {
            "X-CSRFToken": getCookie('csrftoken'),
            "X-Requested-With": "XMLHttpRequest"
        }
    }).then(res => res.json())
      .then(data => {
        if (data.success) location.reload();
    });
}
</script>
{% endblock %}
